{%load static%}
{% include 'messages.html' %}
<script>
    setTimeout(function(){
      if ($('#msg').length > 0) {
        $('#msg').remove();
      }
    }, 2000)
</script>
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">

        <!-- Última versão CSS compilada e minificada do Bootstrap-->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
            
        <!-- Bootstrap icons-->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css" rel="stylesheet" />

        <!-- Favicon-->
        <link rel="icon" type="image/x-icon" href={%static "plantacao_app/assets/icone.png" %} />

        <!-- JavaScript -->
        <script src={%static "plantacao_app/js/scripts.js"%} ></script>
        
        <!-- CSS -->
        <link href={%static "plantacao_app/css/style.css" %} rel="stylesheet" referrerpolicy="origin"></script>
        <!-- Toggle button -->
        <link href="https://cdn.jsdelivr.net/gh/gitbrent/bootstrap4-toggle@3.6.1/css/bootstrap4-toggle.min.css" rel="stylesheet">
        <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>


        <!-- Icones fontaweasome-->
        <script src="https://kit.fontawesome.com/4169326a4c.js" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.4/jspdf.debug.js"></script>

        <!-- Toggle button -->
        <script src="https://cdn.jsdelivr.net/gh/gitbrent/bootstrap4-toggle@3.6.1/js/bootstrap4-toggle.min.js"></script>

        <title>Plantacao IOT</title>
    </head>
        <header class="main-header-container">
            <div class="main-header box-container">
                <p class="main-logo" href="/">
                        <span><i class="fa-solid fa-leaf"></i> Plantação IOT</span>
                </p>
            </div>
        </header>
    <body>
        <main class="main-content-container m-5">
            <div class="main-content main-content-list row-cols-1 justify-content-center mt-5">
                <div class="col quadro"><div class="TextoTituloCardOnOff"></div>
                    <div class="box_dadosTitulo">
                        <i class="fa-solid fa-faucet-drip"></i> Status da Irrigação
                    </div>
                    <div class="box_dadosConteudo">
                        <!--
                        <label class="switch">
                            <input type="checkbox" id="togBtn">
                            <div class="slider round">
                            <span class="on">ON</span>
                            <span class="off">OFF</span>
                            </div>
                        </label>
                        <br>
                        -->
                        <p class="dados_previsao"><span id="status_torneira"><i class="fa-solid fa-power-off"></i> <span id='status'> {{status}}</span></i></span></p>
                    </div>
                </div>

                <div class="col quadro"><div class="TextoTituloCardUmidSolo"></div>
                    <div class="box_dadosTitulo">
                        <i class="fa-solid fa-droplet"></i> Umidade do solo
                    </div>
                    <div class="box_dadosConteudo">
                        <p class="dados_previsao">Umidade do solo: <span id="umidadeSolo"><i class="fa-solid fa-droplet"></i> <span id='umidade_solo'>{{umidade_solo}}</span>%</i></span></p>
                    </div>
                </div>

                <div id='ff' class="col quadro"><div class="TextoTituloCardTemp"></div>
                    <div class="box_dadosTitulo">
                        <i class="fa-solid fa-temperature-three-quarters"></i> Temperatura<br>
                    </div>
                    <div class="box_dadosConteudo">
                        <p class="dados_previsao">Temperatura atual: <span id="temperatura"><i class="fa-solid fa-temperature-three-quarters"></i> <span id='temperatura_dht11'> {{temperatura_dht11}}</span>º</i></span></p>
                    </div>
                </div>

                <div class="col quadro"><div class="TextoTituloCardChuva"></div>
                    <div class="box_dadosTitulo">
                        <i class="fa-solid fa-cloud-rain"></i> Chuva
                    </div>
                    <div class="box_dadosConteudo">
                        <p class="dados_previsao">Status da chuva: <span id="chuva_status"><i class="fa-solid fa-cloud-rain"></i> <span id="chuva">{{chuva}}</span></span></p>
                    </div>
                </div>

                <div class="col quadro"><div class="TextoTituloCardPrev"></div>
                    <div class="box_dadosTitulo">
                            <i class="fa-solid fa-cloud-sun"></i> Previsão do tempo
                    </div>
                    <div class="box_dadosConteudo">
                            <p class="dados_previsao">Temperatura: <i class="minima"><i class="fa-solid fa-temperature-arrow-down"></i> {{temperatura_minima}}</i> | <i class="maxima"><i class="fa-solid fa-temperature-arrow-up"></i> {{temperatura_maxima}}</i></p>
                            <p class="dados_previsao">Umidade do ar: <i class="minima"><i class="fa-solid fa-down-long"></i> {{umidade_minima}}</i> | <i class="maxima"><i class="fa-solid fa-up-long"></i> {{umidade_maxima}}</i></p>
                    </div>
                </div>

                <div class="col quadro"><div class="TextoTituloCardUmidAr"></div>
                    <div class="box_dadosTitulo">
                        <i class="fa-solid fa-wind"></i> Umidade do ar
                    </div>
                    <div class="box_dadosConteudo">
                        <p class="dados_previsao">Umidade atual: <span id="umidade_ar"><i class="fa-solid fa-wind"></i> <span id="umidadeAr"> {{umidade_dht11}}</span>%</i></span></p>
                    </div>
                </div>
            </div>
        </main>
    </body>
    <footer>
        <div class="foot"><i class="fa-solid fa-seedling"></i> &copy; 2022, Plantação IOT</div>
    </footer>

</html>
    <script>
        function get_fb(){
            var content = '';
            $.ajax({
                type: 'POST',
                url: '/results',
                contentType: 'application/json; charset=utf-8',
                cache: false,
                complete: function(data){
                    setTimeout(function(){get_fb();}, 2000);
                    document.getElementById('status').innerHTML=data.responseJSON['status'];
                    document.getElementById('umidade_solo').innerHTML=data.responseJSON['umidadeSolo'];
                    document.getElementById('temperatura_dht11').innerHTML=data.responseJSON['temperatura'];
                    document.getElementById('chuva').innerHTML=data.responseJSON['chuva'];
                    document.getElementById('umidadeAr').innerHTML=data.responseJSON['umidadeAr'];

                    status = data.responseJSON['status'];
                    umidadeSolo = data.responseJSON['umidadeSolo'];
                    temp = data.responseJSON['temperatura'];
                    chuva = data.responseJSON['chuva'];
                    umidade_ar = data.responseJSON['umidadeAr'];
                    
                    /*Temperatura*/
                    showMetricsData(temp, 30, 'temperatura', 'maxima', 'minima')
                    
                    /*Umidade do solo*/
                    showMetricsData(umidadeSolo, 50, 'umidadeSolo', 'minima', 'maxima')

                    /*Umidade do ar*/
                    showMetricsData(umidade_ar, 50, 'umidade_ar', 'minima', 'maxima')

                    /*Chuva*/
                    showBetterData('chuva', 'Sem chuva', 'Chovendo')
                    showMetricsData(chuva, 1, 'chuva_status', 'statusoff', 'statuson')

                    /*Status*/
                    showBetterData('status', 'Ligado', 'Desligado')
                    showMetricsData(status, 1, 'status_torneira', 'statuson', 'statusoff')
                },
            });
        }
        get_fb();
        function SaveData(){
            var content = '';
            $.ajax({
                type: 'POST',
                url: '/saveInfo',
                contentType: 'application/json; charset=utf-8',
                cache: false,
                complete: function(data){
                    setTimeout(function(){SaveData();}, 3600000);
                },
            });
        }
        SaveData();   
</script>

